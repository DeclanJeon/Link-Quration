# 링크 큐레이션 시스템 설계서

## 1. 시스템 개요

링크 큐레이션 시스템은 웹 링크를 저장, 관리, 분석하는 도구입니다. 사용자는 웹 페이지의 링크를 저장하고, AI를 활용하여 콘텐츠를 분석하며, 카테고리별로 정리할 수 있습니다. 또한 동영상, 오디오, 이미지 등 다양한 미디어 콘텐츠도 지원합니다.

## 2. 시스템 아키텍처

### 2.1. 프론트엔드

- **프레임워크**: Next.js 13+ (App Router 사용)
- **UI 라이브러리**: Radix UI, Shadcn/UI
- **상태 관리**: React Context API, React Query
- **폼 관리**: React Hook Form
- **스타일링**: Tailwind CSS
- **차트**: Recharts

### 2.2. 백엔드

- **런타임**: Node.js (Next.js API Routes)
- **API 엔드포인트**:
  - `/api/extract-content`: 웹 페이지 콘텐츠 추출
  - `/api/ai-analyze`: AI를 통한 콘텐츠 분석
  - `/api/media-detect`: 미디어 콘텐츠 감지
  - `/api/media-timeline`: 미디어 타임라인 분석

### 2.3. 주요 의존성

- **콘텐츠 추출**: Mercury Parser, Cheerio, Axios
- **AI 분석**: OpenRouter API 연동
- **미디어 분석**: TensorFlow.js, @tensorflow-models/coco-ssd
- **유틸리티**: date-fns, class-variance-authority, clsx

## 3. 핵심 기능

### 3.1. 링크 저장 및 관리

- 웹 페이지 URL을 통한 콘텐츠 자동 추출
- 북마크 카드 형태의 직관적인 UI
- 카테고리 및 태그 기반 분류
- 검색 및 필터링 기능

### 3.2. AI 기반 분석

- 웹 페이지 콘텐츠 요약
- 키워드 및 태그 자동 생성
- 콘텐츠 중요도 분석
- 감정 분석 및 주제 분류

### 3.3. 미디어 콘텐츠 지원

- 동영상 콘텐츠 분석 (YouTube, Vimeo 등)
- 오디오 콘텐츠 분석 (팟캐스트 등)
- 이미지 콘텐츠 분석 및 태깅
- 미디어 타임라인 생성

### 3.4. 설정 및 사용자 환경

- 다크 모드 지원
- AI 모델 선택 (OpenRouter 통합)
- API 키 관리
- 내보내기/가져오기 기능

## 4. 데이터 모델

### 4.1. 북마크 (Bookmark)

```typescript
interface Bookmark {
  id: string;
  url: string;
  title: string;
  description?: string;
  category: string;
  tags: string[];
  createdAt: Date;
  updatedAt: Date;
  metadata: {
    siteName?: string;
    author?: string;
    publishedDate?: string;
    readingTime?: string;
    wordCount?: number;
    previewImage?: string;
  };
  analysis?: {
    summary?: string;
    keyPoints?: string[];
    sentiment?: 'positive' | 'neutral' | 'negative';
    topics?: string[];
    importance?: number; // 1-5
  };
  mediaInfo?: {
    type: 'video' | 'audio' | 'image';
    duration?: number; // 초 단위
    thumbnail?: string;
    transcript?: string;
    chapters?: Array<{
      title: string;
      start: number; // 초 단위
      end?: number;
    }>;
  };
}
```

## 5. API 명세

### 5.1. 콘텐츠 추출 API (`POST /api/extract-content`)

**요청 본문:**
```typescript
{
  "url": string,          // 필수: 추출할 URL
  "enableAI": boolean,    // 선택: AI 분석 사용 여부
  "apiKey"?: string,      // 선택: OpenRouter API 키
  "modelId"?: string      // 선택: 사용할 AI 모델 ID
}
```

**응답 예시 (성공 시):**
```json
{
  "success": true,
  "data": {
    "title": "페이지 제목",
    "content": "주요 콘텐츠 텍스트",
    "excerpt": "요약된 설명",
    "siteName": "사이트 이름",
    "author": "작성자",
    "publishedDate": "2023-01-01",
    "readingTime": "5분",
    "wordCount": 1200,
    "previewImage": "https://...",
    "mediaType": "article",
    "language": "ko",
    "aiAnalysis": {
      "summary": "AI가 생성한 요약...",
      "tags": ["태그1", "태그2"],
      "sentiment": "positive",
      "topics": ["주제1", "주제2"]
    }
  }
}
```

### 5.2. AI 분석 API (`POST /api/ai-analyze`)

**요청 본문:**
```typescript
{
  "extractedData": object,  // 추출된 콘텐츠 데이터
  "apiKey": string,         // OpenRouter API 키
  "modelId": string,        // 사용할 AI 모델 ID
  "analysisType": "summary" | "complete" | "custom",
  "isMediaContent"?: boolean,
  "mediaUrl"?: string,
  "mediaAnalysisOptions"?: {
    "includeTimeline"?: boolean,
    "includeTranscript"?: boolean,
    "analysisDepth"?: "basic" | "detailed" | "comprehensive",
    "extractQuotes"?: boolean,
    "generateChapters"?: boolean
  }
}
```

## 6. 성능 고려사항

1. **캐싱 전략**:
   - 추출된 콘텐츠는 일정 기간 캐시하여 중복 요청 방지
   - AI 분석 결과는 별도 저장소에 저장하여 재사용

2. **점진적 로딩**:
   - 대용량 콘텐츠는 청크 단위로 나누어 스트리밍
   - 이미지 및 미디어는 지연 로딩 적용

3. **오류 처리**:
   - 재시도 메커니즘 구현
   - 실패한 요청에 대한 자동 복구 시도
   - 사용자에게 명확한 오류 메시지 제공

## 7. 보안 고려사항

1. **API 키 관리**:
   - 프론트엔드 코드에 하드코딩하지 않음
   - 환경 변수를 통한 안전한 관리
   - 사용자별 API 키는 안전한 저장소에 암호화하여 저장

2. **입력 검증**:
   - 모든 사용자 입력에 대한 유효성 검사
   - XSS(Cross-Site Scripting) 방지를 위한 이스케이프 처리
   - CORS 정책을 통한 접근 제어

3. **데이터 보호**:
   - 민감한 정보는 암호화하여 저장
   - 개인정보 처리방침 준수
   - 정기적인 보안 감사

## 8. 확장성 및 유지보수

1. **모듈화된 아키텍처**:
   - 기능별로 독립적인 모듈로 분리
   - 의존성 주입을 통한 느슨한 결합

2. **테스트 전략**:
   - 단위 테스트: 핵심 로직에 대한 테스트 커버리지 확보
   - 통합 테스트: API 엔드포인트 테스트
   - E2E 테스트: 사용자 시나리오 기반 테스트

3. **모니터링 및 로깅**:
   - 성능 메트릭 수집
   - 에러 추적 및 알림 시스템
   - 사용자 행동 분석

## 9. 개선이 필요한 부분 (구체적 제안)

1. **성능 최적화**
   - **대용량 미디어 처리**: 1GB 이상의 동영상/오디오/이미지 파일 처리 시 서버 메모리 및 네트워크 병목 현상 발생. 
     - *개선 방안*: 미디어 파일을 스트리밍 방식으로 처리하거나, 썸네일/프리뷰만 우선 추출하여 비동기적으로 전체 분석을 수행. AWS S3 등 외부 저장소 연동 고려.
     - *예시*: 동영상 전체 분석이 오래 걸릴 경우, 우선 제목/썸네일/길이만 반환하고, 상세 분석 결과는 별도 API나 Webhook으로 제공.
   - **AI 분석 응답 속도**: OpenRouter 등 외부 AI API 호출 시 응답 지연.
     - *개선 방안*: 분석 요청을 큐에 등록 후 비동기 처리, 결과는 푸시 알림/이메일/웹소켓 등으로 사용자에게 전달.
     - *예시*: 분석 대기열 및 진행률 표시 기능 추가.

2. **에러 처리 강화**
   - **복구 메커니즘 부재**: 네트워크 장애, 외부 API 실패 시 재시도 로직 미흡.
     - *개선 방안*: Axios 등 HTTP 클라이언트의 retry 옵션 활용, 실패 시 백오프(backoff) 전략 적용.
     - *예시*: 3회까지 자동 재시도, 실패 시 관리자 알림 및 로그 저장.
   - **오류 메시지 개선**: 기술적인 에러 메시지 대신, 사용자가 이해하기 쉬운 안내 메시지 제공 필요.
     - *개선 방안*: 에러 코드 체계화 및 사용자 친화적 메시지 매핑.
     - *예시*: "분석에 실패했습니다. 잠시 후 다시 시도해 주세요." 등.

3. **테스트 커버리지 확대**
   - **테스트 케이스 부족**: 주요 로직(콘텐츠 추출, AI 분석, 미디어 처리 등)에 대한 단위/통합 테스트 미흡.
     - *개선 방안*: Jest, React Testing Library 등 도구 도입, 테스트 코드 작성 문화 정착.
     - *예시*: API 응답 포맷, 예외 처리, 컴포넌트 렌더링 테스트 등 구체적 시나리오 작성.
   - **CI/CD 파이프라인**: 테스트 자동화 및 배포 전 검증 단계 미구축.
     - *개선 방안*: GitHub Actions, GitLab CI 등으로 Pull Request마다 자동 테스트 실행.
     - *예시*: main 브랜치 병합 전 반드시 테스트 통과 요구.

4. **접근성 개선**
   - **WCAG 준수 미흡**: 색상 대비, 폰트 크기, ARIA 속성 등 접근성 표준 부족.
     - *개선 방안*: Lighthouse, axe 등 접근성 검사 도구 활용, 주요 UI 컴포넌트 점검.
     - *예시*: 버튼/링크에 올바른 레이블 추가, 색상 대비 4.5:1 이상 유지.
   - **키보드/스크린리더 지원**: 마우스 없이 모든 기능 사용 가능하도록 Tab 이동, 포커스 관리 필요.
     - *개선 방안*: TabIndex, ARIA 속성, 스킵 네비게이션 등 적용.
     - *예시*: 모달 오픈 시 포커스 트랩 구현, 스크린리더용 숨김 텍스트 제공.

5. **문서화 보완**
   - **API 문서 자동화**: Swagger(OpenAPI), Redoc 등 도구로 API 명세 자동 생성.
     - *개선 방안*: API 스펙 변경 시 자동 문서화, 샘플 요청/응답 제공.
     - *예시*: `/api/docs` 엔드포인트에서 최신 API 문서 제공.
   - **사용자/개발자 가이드**: 실제 사용 예시, 설치/배포 방법, Trouble Shooting 등 실질적 가이드 부족.
     - *개선 방안*: README, Wiki, Notion 등 외부 문서와 연계.
     - *예시*: "AI 분석 설정법", "미디어 타임라인 활용법" 등 튜토리얼 추가.

## 10. UI/UX 개선 계획

### 10.1. 현재 UI 구조

#### 10.1.1. 메인 페이지 (`/`)
- **구성 요소**:
  - 사이드바: 카테고리 필터링
  - 헤더: 검색 바, 북마크 추가 버튼
  - 컨텐츠 영역: 북마크 카드 그리드
  - AI 설정 안내 배너
- **개선 필요 사항**:
  - 반응형 디자인 미흡 (모바일 대응 필요)
  - 카드 간격 및 정렬 최적화 필요
  - 로딩 상태 표시 부재
  - 빈 상태(No items) UI 미구현

#### 10.1.2. 북마크 추가 모달
- **구성 요소**:
  - 기본 정보 탭 (URL, 제목, 설명 등)
  - 미리보기 탭
  - AI 분석 탭
  - 고급 설정 탭
- **개선 필요 사항**:
  - 폼 유효성 검사 강화
  - URL 입력 시 자동 완성 기능
  - 태그 입력 UX 개선
  - 대용량 미디어 업로드 시 진행 상태 표시 필요

### 10.2. 추가/개선이 필요한 UI 컴포넌트

#### 10.2.1. 상세 보기 모달/페이지 (신규)
- **필요성**:
  - 현재 카드 클릭 시 상세 정보를 볼 수 없는 문제 해결
  - 콘텐츠의 전체적인 맥락 파악 가능
  - 관련 콘텐츠 추천 기능 추가 가능
- **구현 계획**:
  ```tsx
  // 예시: BookmarkDetailModal 컴포넌트
  interface BookmarkDetailModalProps {
    bookmark: Bookmark;
    isOpen: boolean;
    onClose: () => void;
    onEdit: (id: number) => void;
    onDelete: (id: number) => void;
  }
  ```
- **기능 요구사항**:
  - 북마크의 모든 메타데이터 표시
  - 인라인 편집 기능
  - 소셜 공유 기능
  - 관련 콘텐츠 추천
  - 키보드 네비게이션 지원

#### 10.2.2. 개선이 필요한 기존 컴포넌트
1. **북마크 카드 (`BookmarkCard`)**
   - 현재 문제점:
     - 상호작용 요소(버튼)의 접근성 부족
     - 이미지 로딩 최적화 필요
     - 반응형 레이아웃 미흡
   - 개선 방향:
     - hover/focus 상태 명확히 구분
     - 이미지 lazy loading 적용
     - 웹 접근성 속성(aria-*) 추가

2. **사이드바 (`Sidebar`)**
   - 현재 문제점:
     - 카테고리 관리 기능 부재
     - 드래그 앤 드롭으로 순서 변경 불가
   - 개선 방향:
     - 카테고리 추가/편집/삭제 기능
     - 사용자 정의 정렬 기능
     - 접기/펼치기 상태 유지

3. **헤더 (`Header`)**
   - 현재 문제점:
     - 검색 기능이 제한적
     - 사용자 프로필 메뉴 부재
   - 개선 방향:
     - 고급 검색 필터 추가
     - 사용자 아바타 및 드롭다운 메뉴
     - 다크 모드 토글

### 10.3. 병합/제거할 수 있는 UI 요소

#### 10.3.1. 병합 가능한 요소
1. **설정 관련 기능**
   - 현재: 헤더와 사이드바에 분산된 설정 버튼
   - 개선: 사용자 프로필 메뉴로 통합

2. **필터링 UI**
   - 현재: 카테고리, 태그 필터링이 분리됨
   - 개선: 통합 필터 패널로 재구성

#### 10.3.2. 제거/간소화 가능한 요소
1. **중복된 내비게이션**
   - 문제: 모바일/데스크톱에서 중복된 내비게이션
   - 개선: 반응형 디자인으로 통합

2. **과도한 배너**
   - 문제: AI 설정 안내 배너가 공간을 많이 차지
   - 개선: 토스트 알림으로 대체 또는 접을 수 있게 변경

## 11. 향후 계획 (구체적 로드맵)

1. **오프라인 지원**
   - **서비스 워커 적용**: PWA(Progressive Web App)로 변환, 네트워크 미연결 시에도 북마크 목록, 최근 본 링크 등 핵심 기능 사용 가능하도록 구현
     - *구현 방법*: next-pwa, Workbox 등 라이브러리 적용, 정적 파일 캐싱 및 API 응답 캐싱 정책 설계
     - *기대 효과*: 이동 중, 불안정한 네트워크 환경에서도 사용성 보장
   - **로컬 데이터 동기화**: IndexedDB, localStorage 등 브라우저 저장소를 활용해 임시 저장, 온라인 복귀 시 서버와 자동 동기화
     - *구현 방법*: 데이터 변경 내역 큐 관리, 충돌 해결 정책 설계
     - *예시*: 오프라인에서 추가한 북마크가 온라인 복귀 시 자동 업로드

2. **협업 기능**
   - **북마크 공유/협업**: 사용자가 생성한 북마크 폴더를 팀원과 공유, 실시간 동시 편집/코멘트 기능
     - *구현 방법*: 실시간 데이터베이스(Firebase, Supabase 등) 도입, 권한 관리 체계 추가
     - *예시*: 팀 프로젝트 자료실, 관심사별 북마크 공유
   - **댓글/주석 기능**: 각 북마크에 코멘트, 하이라이트, 인라인 메모 등 추가
     - *구현 방법*: 북마크 데이터 모델 확장, UI 내 댓글/주석 입력 및 표시 컴포넌트 구현
     - *예시*: "이 기사 3단락 참고!"와 같은 팀원 간 피드백

3. **통합 확장**
   - **브라우저 확장 프로그램**: 크롬/엣지 확장으로, 웹서핑 중 바로 북마크 추가 및 AI 분석 요청 가능
     - *구현 방법*: manifest v3 기반 확장 개발, 백엔드 API 연동
     - *예시*: 우클릭 메뉴로 링크 저장, 팝업에서 북마크 분류
   - **모바일 앱 출시**: React Native, Expo 등으로 모바일 UX 최적화, 푸시 알림/오프라인 동기화 지원
     - *구현 방법*: 기존 API 재활용, 모바일 전용 UI 컴포넌트 설계
     - *예시*: 북마크 추가/검색/분석을 모바일에서 바로 처리
   - **외부 서비스 연동**: Notion, Slack, Google Drive 등과의 자동화 연동
     - *구현 방법*: Zapier, IFTTT, Webhook 등 활용, OAuth 인증 적용
     - *예시*: 북마크 추가 시 Notion에 자동 기록, Slack 알림 전송 등

4. **고급 분석 기능**
   - **독서 습관/사용자 행동 분석**: 사용자가 저장/분석한 링크의 주제, 시간대, 빈도 등 패턴 분석 및 시각화
     - *구현 방법*: 로그 데이터 수집, 차트/리포트 컴포넌트 추가, 개인화 대시보드 제공
     - *예시*: "최근 한 달간 IT 분야 기사 20건 저장", "주말에 북마크 추가가 많음" 등
   - **콘텐츠 추천 시스템**: 사용자의 관심사, 과거 저장 링크 기반으로 새로운 웹/미디어 콘텐츠 추천
     - *구현 방법*: 간단한 rule-based 추천 → 협업 필터링/AI 추천으로 단계적 고도화
     - *예시*: "이런 기사도 읽어보세요" 섹션 제공
   - **지식 그래프 구축**: 북마크 간 주제, 태그, 인용구 등 관계를 시각화하여 네트워크 형태로 제공
     - *구현 방법*: Neo4j 등 그래프DB 연동, D3.js 등 시각화 도구 활용
     - *예시*: "AI" 태그로 연결된 모든 기사/영상 한눈에 보기

---

이 문서는 시스템의 현재 상태를 반영하고 있으며, 지속적으로 업데이트될 예정입니다. 주요 변경사항이 있을 때마다 문서를 갱신하여 모든 팀원이 최신 정보를 공유할 수 있도록 하겠습니다.
